<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zoom L-20R - גרסת גילוי 2.4</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #001f3f; color: #FFD700; padding: 20px; }
        #connectBtn { background: #fff; color: #001f3f; border: none; padding: 20px; border-radius: 12px; font-size: 1.3rem; font-weight: bold; width: 100%; cursor: pointer; }
        .log { background: #000; color: #00ff00; text-align: left; padding: 15px; height: 350px; overflow-y: scroll; margin-top: 20px; font-family: monospace; border: 1px solid #FFD700; font-size: 12px; }
        .service-card { background: #003366; margin: 10px 0; padding: 10px; border-radius: 8px; border: 1px solid #fff; font-size: 11px; color: #fff; text-align: left; direction: ltr; }
    </style>
</head>
<body>

    <div style="font-weight: bold; margin-bottom: 10px;">גרסה 2.4 - סורק UUID מוחלט</div>
    <button id="connectBtn">התחבר וגלה שירותים (Deep Scan)</button>

    <div id="servicesOutput"></div>
    <div class="log" id="log">לוג אבחון:</div>

    <script>
        const log = (msg) => {
            const div = document.getElementById('log');
            div.innerHTML += `> ${msg}<br>`;
            div.scrollTop = div.scrollHeight;
        };

        document.getElementById('connectBtn').onclick = async () => {
            try {
                log("מחפש מכשיר...");
                // כאן הוספנו את כל ה-UUID הסטנדרטיים האפשריים כדי שהדפדפן לא יחסום אותם
                const device = await navigator.bluetooth.requestDevice({
                    acceptAllDevices: true,
                    optionalServices: [
                        '03b80100-f136-11e1-9103-0800200c9a66', // MIDI Standard
                        '00001800-0000-1000-8000-00805f9b34fb', // Generic Access
                        '00001801-0000-1000-8000-00805f9b34fb', // Generic Attribute
                        '7772e5db-3868-4112-a1a9-f2669d106bf3'  // Zoom Specific
                    ]
                });

                log("מתחבר לשרת GATT של " + device.name + "...");
                const server = await device.gatt.connect();
                log("חיבור פיזי הצליח (נורה כחולה קבועה).");

                log("שואב רשימת שירותים מהמכשיר...");
                const services = await server.getPrimaryServices();
                log(`נמצאו ${services.length} שירותים ראשיים.`);

                const output = document.getElementById('servicesOutput');
                output.innerHTML = "";

                for (const service of services) {
                    log("סורק שירות: " + service.uuid);
                    const card = document.createElement('div');
                    card.className = 'service-card';
                    card.innerHTML = `<strong>Service:</strong> ${service.uuid}`;
                    output.appendChild(card);
                    
                    try {
                        const chars = await service.getCharacteristics();
                        log(`-- נמצאו ${chars.length} מאפיינים בשירות זה.`);
                        chars.forEach(c => {
                            const cInfo = document.createElement('div');
                            cInfo.style.paddingLeft = "15px";
                            cInfo.innerHTML = `└ Characteristic: ${c.uuid}`;
                            card.appendChild(cInfo);
                        });
                    } catch (e) {
                        log("-- שירות זה חסום לקריאה ישירה.");
                    }
                }

            } catch (err) {
                log("שגיאה קריטית: " + err.message);
                console.error(err);
            }
        };
    </script>
</body>
</html>
