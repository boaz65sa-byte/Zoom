<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zoom L-20R - Deep Scan</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #121212; color: #ff3333; padding: 20px; }
        button { background: #ff3333; color: white; border: none; padding: 20px; border-radius: 10px; font-size: 1.2rem; cursor: pointer; width: 100%; }
        .log { background: black; color: #00ff00; text-align: left; padding: 10px; height: 300px; overflow-y: scroll; font-family: monospace; font-size: 13px; margin-top: 20px; border: 1px solid #444; }
    </style>
</head>
<body>

    <h1>בדיקת שירותים עמוקה</h1>
    <button id="scanAllBtn">חבר וסרוק הכל</button>
    <div class="log" id="log">לוג:</div>

    <script>
        const log = (msg) => {
            const div = document.getElementById('log');
            div.innerHTML += `> ${msg}<br>`;
            div.scrollTop = div.scrollHeight;
        };

        document.getElementById('scanAllBtn').onclick = async () => {
            try {
                log("מחפש מכשיר...");
                const device = await navigator.bluetooth.requestDevice({
                    acceptAllDevices: true,
                    // הסרנו את הפילטר הספציפי כדי לא להיחסם
                    optionalServices: [] 
                });

                log("מתחבר ל-" + device.name);
                const server = await device.gatt.connect();
                
                log("מחפש את כל השירותים הזמינים...");
                // כאן אנחנו מבקשים את כל השירותים שהמכשיר מציע
                const services = await server.getPrimaryServices();
                
                if (services.length === 0) {
                    log("שגיאה: לא נמצאו שירותים זמינים. נסה לכבות ולהדליק את ה-BTA-1.");
                }

                services.forEach(async (service) => {
                    log("נמצא שירות: " + service.uuid);
                    const chars = await service.getCharacteristics();
                    chars.forEach(c => {
                        log("--- נמצא מאפיין: " + c.uuid);
                    });
                });

            } catch (err) {
                log("שגיאה קריטית: " + err.message);
                log("טיפ: וודא שאפליקציית האייפד סגורה לחלוטין ושנורית הבלוטות' מהבהבת.");
            }
        };
    </script>
</body>
</html>
