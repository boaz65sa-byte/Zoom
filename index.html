<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zoom L-20R - USB MIDI Control</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #f8f9fa; color: #333; padding: 20px; }
        #connectBtn { background: #007bff; color: white; border: none; padding: 25px; border-radius: 15px; font-size: 1.5rem; width: 100%; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .control-panel { display: none; margin-top: 30px; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        input[type=range] { width: 100%; height: 80px; accent-color: #28a745; cursor: pointer; }
        .log { background: #222; color: #00ff00; text-align: left; padding: 10px; height: 100px; overflow-y: scroll; font-family: monospace; font-size: 12px; margin-top: 20px; border-radius: 10px; }
        h1 { font-size: 3rem; margin: 10px 0; color: #28a745; }
    </style>
</head>
<body>

    <h2 style="color: #007bff;">שליטה ב-Zoom L-20R (דרך USB)</h2>
    <button id="connectBtn">לחץ להפעלת חיבור USB MIDI</button>

    <div id="panel" class="control-panel">
        <h3>Master Fader</h3>
        <input type="range" min="0" max="127" value="0" id="masterFader">
        <h1 id="val">0</h1>
        <p>נסה להזיז את הסליידר - המיקסר אמור להגיב מיד.</p>
    </div>

    <div class="log" id="log">לוג מערכת:</div>

    <script>
        const log = (msg) => {
            const div = document.getElementById('log');
            div.innerHTML += `> ${msg}<br>`;
            div.scrollTop = div.scrollHeight;
        };

        let midiOutput = null;

        document.getElementById('connectBtn').onclick = async () => {
            if (!navigator.requestMIDIAccess) {
                log("הדפדפן שלך לא תומך ב-MIDI. השתמש בכרום באנדרואיד.");
                return;
            }

            try {
                const midiAccess = await navigator.requestMIDIAccess();
                log("גישה ל-MIDI אושרה!");

                const outputs = Array.from(midiAccess.outputs.values());
                if (outputs.length === 0) {
                    log("לא נמצא מכשיר MIDI מחובר ב-USB. וודא שהכבל מחובר.");
                    return;
                }

                // מחפש את המכשיר של זום ברשימת היציאות
                midiOutput = outputs.find(o => o.name.toLowerCase().includes('zoom') || o.name.toLowerCase().includes('l-20')) || outputs[0];
                
                log("מחובר למכשיר: " + midiOutput.name);
                document.getElementById('panel').style.display = 'block';
                document.getElementById('connectBtn').style.display = 'none';

            } catch (err) {
                log("שגיאה בגישה ל-MIDI: " + err.message);
            }
        };

        document.getElementById('masterFader').oninput = (e) => {
            const v = parseInt(e.target.value);
            document.getElementById('val').innerText = v;
            
            if (midiOutput) {
                // שליחת פקודת Control Change (B0), Controller 7 (Volume), Value
                midiOutput.send([0xB0, 0x07, v]);
            }
        };
    </script>
</body>
</html>
